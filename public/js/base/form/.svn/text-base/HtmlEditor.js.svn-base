Ext.define('Base.form.HtmlEditor', {
    extend : 'Ext.form.HtmlEditor',
    addClearInvalidListener: true,
    setTitle : function(title){
      var me = this;
      me.title = title;
    },
    markInvalid: function()
    {
        if(!this.rendered || this.preventMark)
        {
            return;
        }
        if(this.addClearInvalidListener)
        {
            this.on('sync', this.clearInvalid);
            this.addClearInvalidListener = false;
        }
        //Ext.form.HtmlEditor.superclass.markInvalid.apply(this, arguments);
        Ext.get(this.id+"-containerEl").setStyle("border","1px solid #d94e37"); 
    },
    alignErrorIcon: function()
    {
        try{
            this.errorIcon.alignTo(this.wrap, 'tl-tr', [2, 0]);
        }
        catch(err){}
    },
    clearInvalid: function()
    {
        if(!this.rendered || this.preventMark)
        {
            return;
        }
        //Ext.form.HtmlEditor.superclass.clearInvalid.apply(this, arguments);
        Ext.get(this.id+"-containerEl").setStyle("border","none"); 
        //return Ext.form.TextArea.superclass.clearInvalid.call(this);
    },
    validate:function(){
        /*
        if(!this.rendered || this.preventMark)
        {
            return;
        }
        */
        if(this.allowBlank==false && !this.readOnly)
        {
            if(!this.isEmpty())
            {
                this.clearInvalid();
                return true;
            }
            else
            {
                this.markInvalid("This field is required")
                return false;
            }
        }
        else
        {
            this.clearInvalid();
            return true;
        }
    },
    isEmpty:function(){
        var value =this.getValue();
        
        if(!Ext.isEmpty(value))
        {
            value = value.replace(/&nbsp;/gi,"");
            value = value.replace(/<p>/gi,"");
            value = value.replace(/<p align=left>/gi,"");
            value = value.replace(/<p align=right>/gi,"");
            value = value.replace(/<p align=center>/gi,"");
            value = value.replace(/<.p>/gi,"");
            value = value.replace(/<br>/gi,"");
            value = value.trim();
        }

        if(value != '')
            return false;
        return true;
    }
});